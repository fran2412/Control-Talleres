<UserControl x:Class="ControlTalleresMVP.UI.Component.Clases.FormularioClaseUserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:svgc="http://sharpvectors.codeplex.com/svgc/"
             xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
             xmlns:local="clr-namespace:ControlTalleresMVP.UI.Component.Clases"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">
    <!-- Atajos -->
    <UserControl.InputBindings>
        <KeyBinding Key="Enter" Command="{Binding GuardarPagoClasesCommand}"/>
        <KeyBinding Modifiers="Control" Key="L" Command="{Binding LimpiarSeleccionCommand}"/>
        <KeyBinding Key="Escape" Command="{Binding CancelarPagoClasesCommand}"/>
    </UserControl.InputBindings>

    <Grid Background="White">
        <Border Style="{StaticResource BorderGridBase}" Padding="16" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <!-- Header -->
                    <RowDefinition Height="Auto"/>
                    <!-- Alumno/Taller -->
                    <RowDefinition Height="Auto"/>
                    <!-- Cantidad -->
                    <RowDefinition Height="Auto"/>
                    <!-- Monto -->
                    <RowDefinition Height="Auto"/>
                    <!-- Notificación -->
                    <RowDefinition Height="Auto"/>
                    <!-- Resumen -->
                    <RowDefinition Height="Auto"/>
                    <!-- Footer -->
                </Grid.RowDefinitions>

                <!-- HEADER -->
                <DockPanel Grid.Row="0" LastChildFill="False" Margin="0,0,0,8">
                    <TextBlock Text="Pago de clases"
                           FontSize="20" FontFamily="Inter 28pt 28pt ExtraBold"
                           Foreground="#3E3E3E" DockPanel.Dock="Left"/>
                    <TextBlock Text="{Binding FechaDeHoy}"
                           Foreground="#6B7280" VerticalAlignment="Center" Margin="12,0,0,0"/>
                </DockPanel>

                <!-- ALUMNO / TALLER -->
                <WrapPanel Grid.Row="1" Margin="0,0,0,10">
                    <!-- Alumno -->
                    <StackPanel Margin="0,0,20,0">
                        <TextBlock Text="* Alumno" FontFamily="Inter 24pt 24pt Medium" FontSize="14" Margin="0,0,0,4"/>
                        <StackPanel Orientation="Horizontal">
                            <TextBox Text="{Binding AlumnoNombre}" Style="{StaticResource TextBoxCampo}"
                                 IsReadOnly="True" Height="30" Width="360" ToolTip="Alumno seleccionado"/>
                            <Button Command="{Binding BuscarAlumnoCommand}"
                                Style="{StaticResource SemiFeaturedButton}"
                                Height="40" Width="110" Margin="6,0,0,0" ToolTip="Buscar alumno">
                                <svgc:SvgViewbox Source="Resources/Icons/LupaIcono.svg" Width="28" Height="28"/>
                            </Button>
                        </StackPanel>
                    </StackPanel>

                    <!-- Taller -->
                    <StackPanel Margin="0,0,20,0">
                        <TextBlock Text="* Taller" FontFamily="Inter 24pt 24pt Medium" FontSize="14" Margin="0,0,0,9"/>

                        <ComboBox ItemsSource="{Binding TalleresDelAlumno, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              SelectedItem="{Binding TallerSeleccionado, Mode=TwoWay}"
                              DisplayMemberPath="Nombre"
                              Style="{StaticResource MinimalComboBoxStyle}"
                              Width="260" Height="30"
                              ToolTip="Selecciona el taller del alumno para hoy"/>
                    </StackPanel>
                </WrapPanel>

                <!-- CANTIDAD (IntegerUpDown) -->
                <Border Grid.Row="2" Padding="10" CornerRadius="12" Background="#FFF9FAFB" BorderBrush="#EEE" BorderThickness="1" Margin="0,0,0,10">
                    <DockPanel LastChildFill="False">
                        <TextBlock Text="* Cantidad de clases a pagar"
                               DockPanel.Dock="Left"
                               FontFamily="Inter 24pt 24pt Medium" FontSize="14" VerticalAlignment="Center"/>
                        <xctk:IntegerUpDown DockPanel.Dock="Right"
                                        Minimum="1" Maximum="4" Increment="1"
                                        Value="{Binding CantidadSeleccionada, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                        FormatString="N0"
                                        Height="34" Width="120"
                                        HorizontalContentAlignment="Center"
                                        ShowButtonSpinner="True"
                                        AllowTextInput="True"
                                        ToolTip="Usa las flechas o escribe 1–4"/>
                    </DockPanel>
                </Border>

                <!-- MONTO (CurrencyUpDown) -->
                <Grid Grid.Row="3" Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock Text="* Monto a pagar" VerticalAlignment="Center" FontFamily="Inter 24pt 24pt Medium" FontSize="14" Margin="0,0,20,4"/>
                        <xctk:UShortUpDown
                        Value="{Binding MontoIngresado, Mode=TwoWay}"
                        CultureInfo="es-MX"
                        FormatString="C2"
                        Minimum="0"
                        ClipValueToMinMax="True"
                        Height="34" Width="220"
                        ToolTip="Captura el monto total a cobrar"/>
                    </StackPanel>

                    <!-- Sugerido -->
                    <StackPanel Grid.Column="1" Margin="12,0,0,0" VerticalAlignment="Bottom">
                        <TextBlock Text="{Binding MontoSugerido, StringFormat=Sugerido: {0:C2}, UpdateSourceTrigger=PropertyChanged}" Foreground="#6B7280" Margin="0,0,0,4"/>
                        <Button Content="Usar sugerido" Style="{StaticResource BotonNormal}" Height="40" MinWidth="130"
                            Command="{Binding UsarMontoSugeridoCommand}" />
                    </StackPanel>

                    <StackPanel Grid.Column="2" Margin="8,0,0,0" VerticalAlignment="Bottom">
                        <Button Content="Limpiar" Style="{StaticResource BotonNormal}" Height="40" MinWidth="100"
                            Command="{Binding LimpiarSeleccionCommand}"/>
                    </StackPanel>
                </Grid>

                <!-- NOTIFICACIÓN DE TALLERES SIN PAGAR -->
                <Border Grid.Row="4" Background="#FFF3CD" BorderBrush="#FFEAA7" BorderThickness="1" 
                        CornerRadius="6" Padding="12" Margin="0,0,0,8"
                        Visibility="{Binding TieneTalleresSinPagar, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="⚠️" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <TextBlock Text="{Binding NotificacionTalleresSinPagar}" 
                                   Foreground="#856404" FontWeight="SemiBold" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

                <!-- RESUMEN -->
                <Grid Grid.Row="5" Margin="0,0,0,8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBlock Text="{Binding MensajeValidacion}" Foreground="Tomato" VerticalAlignment="Center"/>
                    <TextBlock Grid.Column="1" Text="Total:" Margin="12,0,6,0" VerticalAlignment="Center" Foreground="#555"/>
                    <TextBlock Grid.Column="2" Text="{Binding MontoSugerido, StringFormat={}{0:C2}, UpdateSourceTrigger=PropertyChanged}" FontWeight="Bold" VerticalAlignment="Center"/>
                </Grid>

                <!-- FOOTER -->
                <StackPanel Grid.Row="6" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Cancelar" Command="{Binding CancelarPagoClasesCommand}"
                        Style="{StaticResource BotonNormal}" Height="40" MinWidth="120"/>
                    <Button Content="Guardar" Command="{Binding GuardarPagoClasesCommand}"
                        Style="{StaticResource FeaturedButton}" Height="40" MinWidth="140" Margin="8,0,0,0"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
